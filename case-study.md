1. Заменил to_json на Oj.dump(report).
  Теперь укладываюсь в 29 сек !!! Есть !!!

2. Замерил память
  MEMORY USAGE: 1688 MB
  Нормально так :)

3. Переделываю чтение файла построчно
    сделал общую статистику
    12.835574739 sec
    MEMORY USAGE: 23 MB

4. Переделал полностью построчно
  33.450760559 sec
  MEMORY USAGE: 838 MB

  В 2 раза меньше потребление памяти, но до бюджета далеко

  возможно нужно писать в файл тоже тоже построчно

  Пройдусь профилировщиками, как положено :)

5. Переписал без инстанс @переменных и накопления в хеш, память снизилась до 24 Мб
  Надо доделать нормальную запись в файл и потренироваться с профилировщиками.

6. Дописал запись в json
  Результаты
  22.811699791 sec
  MEMORY USAGE: 24 MB

7. [valgrind massif visualier](https://monosnap.com/direct/csQnUEjdhFHvjEMIIGa3mxrOuaaGF0)
